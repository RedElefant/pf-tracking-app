<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PF Circuit Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#d8b4fe">
<style>
  body { font-family: 'Roboto', sans-serif; margin: 0; background: #f5f6fa; color: #2f3640; }
  h1 { text-align:center; color: #192a56; margin: 10px 0; }
  .button-container { text-align:center; margin-bottom:10px; }
  .button-container button { margin: 0 5px; padding:10px 15px; background:#d7bde2; color:#2f3640; border:none; border-radius:5px; cursor:pointer; }
  table { width:100%; border-collapse:collapse; margin-bottom:20px; }
  th, td { border:1px solid #ccc; padding:6px; text-align:center; }
  th { background:#d7bde2; color:#2f3640; }
  tr:nth-child(even) { background:#dcdde1; }
  select, input[type="checkbox"] { padding:4px; border-radius:4px; font-size:0.9rem; }
  .day-title { text-align:center; font-weight:700; margin:10px 0 5px; }
  .page { display:none; }
  .page.visible { display:block; }
  .back-btn { margin:10px; padding:6px 10px; border:none; border-radius:4px; background:#d7bde2; color:#2f3640; cursor:pointer; }
</style>
</head>
<body>

<h1>3-Day PF Circuit Plan</h1>
<div class="button-container">
  <button onclick="showPage('historyPage')">View History</button>
  <button onclick="showPage('summaryPage')">Weekly Summary</button>
</div>

<div id="mainPage" class="page visible">
  <div class="day-title">Day 1 — Chest & Back Focus</div>
  <table id="day1Table"><tr><th>Exercise</th><th>Sets</th><th>Reps</th><th>Weight</th><th>Done</th></tr></table>

  <div class="day-title">Day 2 — Lower Body Focus</div>
  <table id="day2Table"><tr><th>Exercise</th><th>Sets</th><th>Reps</th><th>Weight</th><th>Done</th></tr></table>

  <div class="day-title">Day 3 — Shoulders & Arms Focus</div>
  <table id="day3Table"><tr><th>Exercise</th><th>Sets</th><th>Reps</th><th>Weight</th><th>Done</th></tr></table>
</div>

<div id="historyPage" class="page">
  <button class="back-btn" onclick="showPage('mainPage')">Back to Main</button>
  <h2 style="text-align:center;">Completed Exercises History</h2>
  <div id="historyContent"></div>
</div>

<div id="summaryPage" class="page">
  <button class="back-btn" onclick="showPage('mainPage')">Back to Main</button>
  <h2 style="text-align:center;">Weekly Summary</h2>
  <div id="summaryContent"></div>
</div>

<script>
let db;
const request = indexedDB.open('WorkoutDB', 1);
request.onupgradeneeded = function(e) {
  db = e.target.result;
  db.createObjectStore('workouts', { keyPath: 'id', autoIncrement: true });
};
request.onsuccess = async function(e) {
  db = e.target.result;
  await populateTables();
  renderHistory();
};

function saveExercise(day, exercise, sets, reps, weight) {
  const tx = db.transaction('workouts','readwrite');
  tx.objectStore('workouts').add({
    date: new Date().toISOString().split('T')[0],
    day, exercise, sets, reps, weight, completed:true
  });
  tx.oncomplete = renderHistory;
}

function deleteExercise(id) {
  const tx = db.transaction('workouts','readwrite');
  tx.objectStore('workouts').delete(id).onsuccess = renderHistory;
}

function renderHistory() {
  const historyDiv = document.getElementById('historyContent');
  historyDiv.innerHTML = '';
  const tx = db.transaction('workouts','readonly');
  tx.objectStore('workouts').getAll().onsuccess = function(event){
    const results = event.target.result;
    if(results.length===0){ historyDiv.innerHTML='<p>No completed exercises yet.</p>'; return; }
    const grouped = {};
    results.forEach(r => { if(!grouped[r.date]) grouped[r.date]=[]; grouped[r.date].push(r); });
    for(const date in grouped){
      const dayGroup = grouped[date];
      const dateHeader = document.createElement('h3'); dateHeader.textContent = date; historyDiv.appendChild(dateHeader);
      const tbl = document.createElement('table');
      tbl.innerHTML = '<tr><th>Day</th><th>Exercise</th><th>Sets × Reps</th><th>Weight</th><th>Delete</th></tr>';
      dayGroup.forEach(e => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${e.day}</td><td>${e.exercise}</td><td>${e.sets} × ${e.reps}</td><td>${e.weight}</td><td><button onclick="deleteExercise(${e.id})">Delete</button></td>`;
        tbl.appendChild(row);
      });
      historyDiv.appendChild(tbl);
    }
  }
}

function showPage(pageId){
  document.querySelectorAll('.page').forEach(p=>p.className='page hidden');
  document.getElementById(pageId).className='page visible';
}

const weightOptions = Array.from({length:11},(_,i)=>20+i*10);
const repsOptions = Array.from({length:7},(_,i)=>8+i*2);
const dayExercises = {
  1: ['Chest Press Machine','Back Extension Machine','Lat Pulldown Machine','Seated Row Machine','Abdominal Crunch Machine','Torso Rotation Machine (per side)','Pec Deck (Butterfly) Machine'],
  2: ['Leg Press Machine','Seated Leg Curl Machine','Leg Extension Machine','Calf Extension Machine','Abdominal Crunch Machine','Hip Abduction Machine','Hip Adduction Machine','Lunge Machine'],
  3: ['Shoulder Press Machine','Torso Rotation Machine (per side)','Abdominal Crunch Machine','Bicep Curl Machine','Tricep Extension Machine','Seated Dip Machine','Rear Delt Fly (Reverse Pec Deck)','Dumbbell Lateral Raise']
};
const daySets={1:3,2:3,3:3};

function createDropdown(options, selected){
  return `<select>${options.map(o=>`<option ${o==selected?'selected':''}>${o}</option>`).join('')}</select>`;
}

async function getLastValue(exercise,type){
  return new Promise(resolve=>{
    const tx = db.transaction('workouts','readonly');
    tx.objectStore('workouts').getAll().onsuccess = function(event){
      const all = event.target.result.filter(e=>e.exercise===exercise);
      resolve(all.length===0?null:all[all.length-1][type]);
    }
  });
}

async function populateTables(){
  for(let day=1; day<=3; day++){
    const table = document.getElementById(`day${day}Table`);
    for(const ex of dayExercises[day]){
      const lastReps = await getLastValue(ex,'reps') || repsOptions[0];
      const lastWeight = await getLastValue(ex,'weight') || weightOptions[0];
      const row = document.createElement('tr');
      const repsDropdown = createDropdown(repsOptions,lastReps);
      const weightDropdown = createDropdown(weightOptions,lastWeight);
      const checkbox = `<input type='checkbox' data-day='${day}'>`;
      row.innerHTML=`<td>${ex}</td><td>${daySets[day]}</td><td>${repsDropdown}</td><td>${weightDropdown}</td><td>${checkbox}</td>`;
      table.appendChild(row);
    }
  }
}

document.body.addEventListener('change', function(e){
  if(e.target && e.target.type==='checkbox' && e.target.dataset.day){
    const row = e.target.closest('tr');
    if(e.target.checked){
      const exercise=row.cells[0].textContent;
      const sets=parseInt(row.cells[1].textContent);
      const reps=parseInt(row.cells[2].querySelector('select').value);
      const weight=parseInt(row.cells[3].querySelector('select').value);
      const day=parseInt(e.target.dataset.day);
      saveExercise(day,exercise,sets,reps,weight);
    }
  }
});

// Optional: Weekly summary logic
</script>

<script>
if('serviceWorker' in navigator){
  window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js').then(reg=>console.log('ServiceWorker registered',reg)).catch(err=>console.log('ServiceWorker registration failed',err)));
}
</script>

</body>
</html>
